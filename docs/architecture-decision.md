# アーキテクチャ決定事項

## SPAモード + Laravel API選択の理由

### 背景
- 将来的にモバイルアプリ（Android/iOS）展開を視野に入れる
- APIの再利用性を最大化したい
- フロントエンドの配信を高速化したい

### 決定事項

#### フロントエンド
- **Nuxt.js SPAモード**（SSRではない）
- ビルド後は静的ファイルとして配信
- nginx または CDN でホスティング
- 認証後のトークンは localStorage または httpOnly Cookie で管理

#### バックエンド  
- **純粋なREST API** として設計
- 認証は Backend for Frontend (BFF) パターン
- OAuth処理後、JWTトークンを発行
- Web/Mobile共通のAPIエンドポイント

#### 認証フロー
1. フロントエンド → `/api/auth/{provider}` リクエスト
2. Laravel → OAuth プロバイダーへリダイレクト
3. コールバック → Laravel で処理
4. JWT トークン生成 → フロントエンドへ返却
5. 以降のAPI通信はJWTトークンで認証

### メリット
- **API再利用**: Web、Android、iOS で同じAPI
- **スケーラビリティ**: フロントは CDN、API は別スケール
- **開発効率**: フロント/API を独立して開発可能
- **パフォーマンス**: 静的配信で高速化

### デメリット
- SEO: SPAなので初期表示は劣る（ただし店舗情報は後から対応可能）
- 初回ロード: JSバンドルサイズに注意が必要

### 将来の拡張性
```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  Web (SPA)  │     │   Android   │     │     iOS     │
└──────┬──────┘     └──────┬──────┘     └──────┬──────┘
       │                    │                    │
       └────────────────────┴────────────────────┘
                            │
                    ┌───────▼────────┐
                    │  Laravel API   │
                    │  (JWT Auth)    │
                    └───────┬────────┘
                            │
                    ┌───────▼────────┐
                    │   PostgreSQL   │
                    └────────────────┘
```