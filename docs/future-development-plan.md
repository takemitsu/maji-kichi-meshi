# 将来の開発計画

**最終更新**: 2025-10-17
**プロジェクト状況**: Phase 1-9 完了（100%完成）

## 📊 現在の実装状況

### ✅ 完了済み機能（Phase 1-9）

**コア機能**:
- OAuth認証 + JWT トークン管理
- 店舗管理（登録・編集・検索）
- カテゴリ管理（基本カテゴリ + 時間帯タグ）
- レビュー機能（星評価・リピート意向・画像アップロード）
- ランキング機能（カテゴリ別・公開設定・正規化構造）
- いいね機能（オプショナル認証対応）
- 行きたいリスト機能（優先度・ステータス管理）

**画像処理システム**:
- 4サイズ自動リサイズ（thumbnail/small/medium/large）
- レビュー画像・店舗画像・プロフィール画像対応
- 画像検閲機能（承認・拒否・一括操作）
- 遅延生成機能（LazyImageService - 2025-09-22デプロイ済み）

**管理機能（Laravel Filament）**:
- ユーザー管理（2FA必須・ステータス制御・強制退会）
- 店舗管理（モデレーション・非表示・削除）
- 画像検閲（ステータス別フィルタリング・一括操作）
- レビュー/ランキング管理
- カテゴリ管理
- 管理者ログイン試行記録

**統計・分析**:
- 統計ダッシュボード（StatsController）
- ユーザー別統計データ集計
- リアルタイム統計表示

**その他**:
- Google Maps リンク連携（店舗詳細から検索リンク生成）
- フロントエンド完全実装（Vue/Nuxt SPA + モバイル対応）
- 包括的テストカバレッジ（289テスト、1360アサーション）
- 本番デプロイ完了（deploy.sh 自動デプロイ対応）

## 🚀 次期開発候補

### 優先度: 高

#### 1. Google Places API 連携

**概要**: 店舗情報の自動取得・検索機能

**実装内容**:
- 店舗登録時の検索・自動入力
- Place Details API での詳細情報取得
- ローカルDB優先検索（コスト削減）

**料金試算**:
- 軽い利用（2-3店舗/回）: 月$2.03 → 100人まで対応可能
- 重い利用（20店舗/回）: 月$18.40 → 11人まで対応可能
- 吉祥寺は店舗多数のため、重い利用パターンが想定される

**API制限対策**:
- 月間予算上限設定（$200無料枠）
- 日次・月次リクエスト制限
- 使用量監視・アラート機能
- 上限到達時の代替データソース切り替え

**店舗登録フロー設計**:
```
1. ユーザー: 店名入力（住所不明でもOK）
2. システム: ローカルDB検索（高速・無料）
3. 見つからない場合: Google Places Search API
4. 候補リスト表示 → ユーザー選択
5. Place Details API で詳細情報取得
6. DB保存（次回はローカル検索で発見）
```

**代替データソース候補**:
- OpenStreetMap（完全無料）
- Yahoo! ローカルサーチ API（月50,000リクエスト無料）
- ぐるなび API（月1,000リクエスト無料）
- ホットペッパー API（月3,000リクエスト無料）

**注意事項**:
- Google Places Photos は利用規約により永続保存禁止
- 現在のユーザー投稿画像システムを継続利用
- Google 画像はリアルタイム表示のみ（参考程度）

**API設計**:
```
GET    /api/places/search           # 店舗検索
GET    /api/places/{place_id}       # Google Places詳細
```

#### 2. 通報システム

**概要**: 不適切なコンテンツの通報機能

**実装内容**:
- レビュー・画像・店舗情報の通報
- 通報理由の選択（不適切な内容・スパム・虚偽情報等）
- 管理画面での通報一覧・対応履歴
- 自動通知（管理者へのメール・Slack連携）

**データベース設計**:
```sql
reports (
    id, user_id, reportable_type, reportable_id,
    reason, description, status,
    reviewed_by, reviewed_at,
    created_at, updated_at
)
```

**API設計**:
```
POST   /api/reports                 # 通報投稿
GET    /api/admin/reports           # 通報一覧（管理者のみ）
PUT    /api/admin/reports/{id}      # 通報対応（管理者のみ）
```

### 優先度: 中

#### 3. パフォーマンス最適化

**API キャッシュ**:
- Redis キャッシュ導入（現在はRate Limiter専用）
- カテゴリ一覧のキャッシュ
- 公開ランキングのキャッシュ
- 統計データのキャッシュ

**N+1 クエリ対策**:
- Eager Loading の徹底確認
- クエリ最適化
- インデックス追加

**画像配信最適化**:
- CDN導入検討
- WebP形式対応
- レスポンシブ画像配信

#### 4. メール通知機能

**実装内容**:
- 新規ユーザー登録通知
- 画像承認・拒否通知
- レビューへのいいね通知
- 行きたいリストの店舗が更新された通知

**技術スタック**:
- Laravel Mail
- キュー処理（Laravel Queue）
- メールテンプレート（Blade）

### 優先度: 低

#### 5. セキュリティ強化

**アクセスログ**:
- ユーザーアクセス履歴
- API呼び出しログ
- 不正アクセス検知

**セキュリティアラート**:
- 異常なアクセスパターン検知
- レート制限超過アラート
- 不正ログイン試行アラート

#### 6. バックアップ・復旧機能

**データバックアップ**:
- 自動バックアップスクリプト
- データベースバックアップ（日次・週次）
- 画像ファイルバックアップ

**復旧機能**:
- バックアップからの復元手順
- データ整合性チェック

## 🎯 フェーズ別実装計画

### Phase 10: 外部API連携（未開始）
- Google Places API 統合
- Google Maps 埋め込み
- 店舗情報自動取得

### Phase 11: 運用機能強化（未開始）
- 通報システム
- メール通知機能
- パフォーマンス最適化

### Phase 12: セキュリティ・運用（未開始）
- アクセスログ
- セキュリティアラート
- バックアップ機能

## 📈 実装完了率

| カテゴリ | 完了率 | 状態 |
|---------|--------|------|
| コア機能 | 100% | ✅ 完了 |
| 管理機能 | 100% | ✅ 完了 |
| 画像処理 | 100% | ✅ 完了 |
| 統計・分析 | 100% | ✅ 完了 |
| 外部API連携 | 0% | ❌ 未着手 |
| 通知機能 | 0% | ❌ 未着手 |
| セキュリティ強化 | 40% | 🔄 部分実装 |
| 運用機能 | 40% | 🔄 部分実装 |

**全体進捗**: Phase 1-9完了（100%）、Phase 10-12未着手

## 🔮 将来検討事項

### カテゴリ機能拡張

将来的にカテゴリ機能を拡張する可能性:

- **`description`フィールド**: カテゴリの詳細説明
  - 用途: 管理画面でのカテゴリ説明表示、API応答での説明文提供
  - 実装: `text`型、nullable

- **`is_active`フィールド**: カテゴリの有効/無効切り替え
  - 用途: 一時的にカテゴリを非表示にする、段階的なカテゴリ廃止
  - 実装: `boolean`型、デフォルト`true`

**実装時の影響範囲**:
- マイグレーション: `categories`テーブルにフィールド追加
- モデル: `Category::$fillable`に追加
- API: CategoryResourceに追加（必要に応じて）
- Filament: CategoryResourceの管理画面に追加

### モバイルアプリ対応

- iOS/Androidネイティブアプリ
- 現在のLaravel APIをそのまま利用可能
- プッシュ通知対応

### 他エリア対応

- 吉祥寺以外のエリアへの拡張
- エリア別カテゴリ管理
- 地域別ランキング

## 💡 備考

- 基本的なCRUD機能は100%完成済み
- 管理画面は100%完成
- **外部API連携は全く未実装**
- **通知・通報機能は未実装**
- OAuth設定完了後、即座に本番リリース可能な状態

## 関連ドキュメント

- [technical-specs.md](./technical-specs.md) - 技術仕様・実装詳細
- [database-er-diagram.md](./database-er-diagram.md) - データベース設計
- [deployment-guide.md](./deployment-guide.md) - デプロイメントガイド
