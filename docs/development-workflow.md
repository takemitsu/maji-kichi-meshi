# 機能開発の標準ワークフロー

マジキチメシプロジェクトにおける新機能開発の標準的な進め方を定義します。

## 機能開発ディレクトリ構成

新機能の開発は `docs/features/` ディレクトリを使用してタスク管理を行います。

```
docs/features/
├── feature-name/
│   ├── README.md           # 機能概要・仕様・要件定義
│   ├── 01-task-name.md     # 個別タスク（連番）
│   ├── 02-task-name.md     # 個別タスク
│   ├── 03-task-name.md     # 個別タスク
│   └── progress.md         # 進捗状況・完了記録
└── another-feature/
    ├── README.md
    └── ...
```

### ファイル構成の詳細

#### `README.md` - 機能概要
- **目的**: 機能の概要・仕様・要件を記載
- **内容**:
  - 機能の目的・背景
  - 主要な要件・仕様
  - 技術的制約・考慮事項
  - 完了基準
  - 関連する既存機能・影響範囲

#### `XX-task-name.md` - 個別タスク
- **命名**: 2桁連番 + タスク名（例: `01-user-profile-api.md`）
- **内容**:
  - タスクの詳細説明
  - 実装すべき機能・API
  - テスト要件
  - 注意点・参考情報

#### `progress.md` - 進捗管理
- **目的**: 全体進捗・完了状況の記録
- **内容**:
  - タスク一覧とステータス
  - 完了日時の記録
  - 発見した課題・対応方法
  - 次フェーズへの引き継ぎ事項

## 開発フロー

### 1. 機能企画・要件定義
```bash
# 新機能ディレクトリ作成
mkdir docs/features/user-profile-pages

# 機能概要作成
touch docs/features/user-profile-pages/README.md
```

### 2. タスク分解・計画
- `README.md` に機能仕様を記載
- 個別タスクに分解（`01-*.md`, `02-*.md`...）
- `progress.md` でタスク一覧・進捗管理開始

### 3. 開発実行
- タスク順序に従って順次実装
- **🚨 必須**: 各タスク完了時に `progress.md` を即座に更新
- **🚨 必須**: タスク開始時にもprogress.mdでステータス変更
- コードレビュー・テスト実施

#### progress.md更新の必須タイミング
1. **タスク開始時**: ステータスを「⏳ 未着手」→「🔄 実行中」に変更
2. **タスク完了時**: ステータスを「🔄 実行中」→「✅ 完了」に変更、完了日時記録
3. **問題発生時**: 課題・対応方法を記録
4. **最終完了時**: 全体サマリー・引き継ぎ事項記録

**⚠️ progress.md未更新は重大なワークフロー違反とし、レビューで厳格に指摘されます**

## 🚨 実装漏れ防止の必須プロセス

### 実装開始前の必須チェック

#### 📋 **実装開始前チェックリスト実施義務**

**すべての実装者は実装開始前に以下を必ず実施すること：**

1. **`docs/templates/implementation-checklist.md` を使用**
2. **対象ページ・機能をすべて特定**
3. **不明点を明文化・解決**
4. **実装計画を詳細化**

#### 🚨 **実装開始条件**
以下がすべて完了するまで実装開始禁止：
- [ ] implementation-checklistが100%完了
- [ ] 不明点がすべて解決済み  
- [ ] 実装対象が明確に特定済み
- [ ] 重要な場合はタスク設計者への確認完了

#### ⚠️ **よくある実装漏れパターン**
1. **複数ページ対象なのに一部のみ実装**
   - 例: レビューページは実装、ランキングページは未実装
2. **公開ページと認証ページの混同**
   - 例: `/rankings` を認証必要と誤解して未実装
3. **機能仕様の勝手な決めつけ**
   - 例: 「プライバシー的に実装不要」と独断

#### ✅ **防止方法**
- **対象ページリストの必須作成**
- **各ページの認証要件明記**
- **不明点は必ず質問（推測禁止）**

### 4. 完了・統合
- 全タスク完了後、機能テスト実施
- `progress.md` に最終結果・引き継ぎ事項記録
- 必要に応じて `technical-specs.md` に機能追加

## 具体例: ユーザープロフィールページ機能

```
docs/features/user-profile-pages/
├── README.md                    # 機能概要・要件
├── 01-user-profile-api.md       # バックエンドAPI実装
├── 02-frontend-pages.md         # フロントエンドページ作成
├── 03-integration-test.md       # 統合テスト・動作確認
└── progress.md                  # 進捗管理
```

### README.md の例
```markdown
# ユーザープロフィールページ機能

## 概要
他のユーザーのプロフィール・レビュー・ランキングを閲覧できる機能

## 要件
- `/users/{user_id}` でプロフィール表示
- `/users/{user_id}/reviews` でレビュー一覧
- `/users/{user_id}/rankings` でランキング一覧

## 技術要件
- Laravel API追加
- Vue.js ページ追加  
- 認証不要（公開情報のみ）

## 完了基準
- [ ] API実装・テスト完了
- [ ] フロントエンド実装完了
- [ ] 統合テスト・動作確認完了
```

## ツール・コマンド

### 進捗確認
```bash
# 全機能の進捗確認
find docs/features -name "progress.md" -exec echo "=== {} ===" \; -exec cat {} \;

# 特定機能の詳細確認
cat docs/features/user-profile-pages/README.md

# progress.md未更新チェック
find docs/features -name "progress.md" -exec grep -L "✅ 完了\|🔄 実行中" {} \;
```

### progress.md更新リマインダー

**🚨 実装中のClaude君へ: 以下のタイミングで必ずprogress.mdを更新してください**

#### タスク開始時
```bash
# 1. progress.mdを開く
# 2. 該当タスクのステータスを変更: ⏳ → 🔄  
# 3. 開始日時を記録: 2025-07-25 10:30
# 4. 実装記録に開始ログ追加
```

#### タスク完了時  
```bash
# 1. progress.mdを開く
# 2. 該当タスクのステータスを変更: 🔄 → ✅
# 3. 完了日時を記録: 2025-07-25 15:45  
# 4. テスト結果・完了内容を記録
```

#### 問題発生時
```bash  
# 1. progress.mdの「発見した課題・対応方法」セクションに追記
# 2. 問題内容・対応方法・結果を詳細記録
```

**📋 忘れ防止チェック**
- タスク作業前: progress.mdの現在状況確認
- 作業中断時: 現在の進捗状況記録  
- 作業完了時: ステータス更新・完了記録

### テンプレート作成
```bash
# 新機能用ディレクトリ・ファイル一括作成例
mkdir docs/features/new-feature
touch docs/features/new-feature/{README.md,progress.md}
```

## 注意事項

### ファイル管理
- **固定ファイル**: `README.md`, `progress.md`
- **可変ファイル**: `XX-*.md` (タスク内容に応じて追加・削除)
- **アーカイブ**: 完了した機能は `docs/features/` に残し、参考資料として活用

### 品質管理
- 各タスクには必ずテスト要件を含める
- コードレビューの実施を前提とする
- 既存機能への影響を必ず検討・記録する

#### 必須レビューチェックリスト
**レビュアーは以下を必ず確認してください：**

##### 📋 進捗管理チェック (最優先)
- [ ] `progress.md` が最新状況を反映している
- [ ] 全タスクのステータス（未着手/実行中/完了）が正確
- [ ] 完了タスクに完了日時が記録されている
- [ ] 課題・対応方法が適切に記録されている

##### 🚨 実装対象網羅性チェック (最優先)
- [ ] **対象ページ・機能がすべて実装されている**
- [ ] タスク要件で指定された全URLパターンに対応済み
- [ ] 公開ページ・認証ページの区別が正しく実装されている
- [ ] 実装漏れがないことを個別に確認済み

**🔍 実装漏れ検出方法:**
1. タスクのREADME.mdで対象を再確認
2. URL設計で指定された全パターンをチェック
3. 各ページで実際に機能動作を確認
4. 完了基準チェックリストと実装内容を照合

##### 🔧 技術実装チェック  
- [ ] 実装がタスク要件を満たしている
- [ ] テストが完了し、結果が記録されている
- [ ] 既存機能への影響がないか確認済み
- [ ] コード品質（型チェック・lint等）が合格

**❌ progress.md未更新または実装漏れがある場合、技術実装が完璧でもレビュー不合格とする**

### タスク記述の適切なレベル
**タスクは「What（何を）」と「Why（なぜ）」に集中し、「How（どう）」は実装者に委ねる**

#### ✅ 適切なタスク内容
- **目的・要件**: 何を達成するか、なぜ必要か
- **完了基準**: 何ができれば完了とするか
- **制約・注意点**: 考慮すべき技術的制約
- **参考技術**: 使用する技術スタック・ライブラリ

#### ❌ 避けるべき詳細レベル
- **具体的なコード例**: 完全な実装コードの提示
- **実装手順**: ステップバイステップの作業指示
- **技術的実装詳細**: 内部ロジックの詳細設計

#### 📝 タスク記述例

**適切なレベル**:
```markdown
## タスク: ユーザーフィルタ機能実装

### 目的
レビュー・ランキング一覧を特定ユーザーでフィルタリング可能にする

### 要件
- QueryString（`?user_id=123`）でのフィルタリング
- 既存ページネーション機能との互換性維持
- 存在しないuser_idのエラーハンドリング

### 完了基準
- [ ] APIがuser_idパラメータに対応
- [ ] フロントエンドでQueryString処理が動作
- [ ] バリデーション・エラーハンドリング実装完了
```

**過度に詳細な例**:
```markdown
// ❌ タスクレベルとしては詳細すぎる
### 実装コード
public function index(Request $request) {
    $query = Review::with(['user', 'shop']);
    if ($request->has('user_id')) {
        $query->where('user_id', $request->user_id);
    }
    return $query->paginate(10);
}
```

#### 🎯 判断基準
**「実装者が創意工夫できる余地があるか？」**
- ✅ 要件を満たす複数のアプローチが存在する → 適切なタスクレベル
- ❌ 手順通りにコピペするだけで完成する → 詳細すぎる

#### 🔄 実装詳細が必要な場合
タスクとは別に以下の方法で対応:
- **設計書**: `docs/technical-specs.md` に詳細設計
- **実装ガイド**: `docs/implementation-guides/` ディレクトリで技術資料
- **コードレビュー**: 実装後のレビューで品質確保

## レビュー・品質管理

機能実装完了後は、必ずレビュープロセスを実施します。

### レビューファイル作成

#### 📝 命名規則
```
docs/features/feature-name/implementation-review.md
```

#### 📋 レビューファイルの構成
```markdown
# 機能名 実装レビュー結果

**実装者**: 実装担当Claude君
**レビュー者**: タスク設計Claude君  
**日時**: YYYY-MM-DD

## 🚨 重要な指摘事項
[progress.md未更新等の重大な問題]

## ✅ 実装品質評価
[技術的実装の評価]

## ⚠️ その他の指摘事項
[軽微な改善提案]

## 🚀 修正依頼
[具体的な修正指示]
```

### 必須チェック項目

#### 🚨 **HIGH Priority - 必ず確認**
- **progress.md更新**: 実装状況の正確な記録
- **完了基準チェックリスト**: 全項目の実施状況
- **ワークフロー準拠**: development-workflow.md の遵守

#### ⚠️ **MEDIUM Priority - 推奨確認**
- 技術的実装品質
- 既存機能への影響
- UI/UX・アクセシビリティ
- セキュリティ・パフォーマンス

### progress.md更新の重要性

**progress.md の更新は必須義務です**

#### ❌ 未更新が重大な問題である理由
1. **プロジェクト管理の根幹**: 進捗の可視性が失われる
2. **次の担当者への混乱**: 実装状況が把握できない  
3. **ワークフロー違反**: 標準化の意味がなくなる
4. **品質管理**: 完了基準チェックが未実施状態

#### ✅ 適切な更新例
```markdown
| タスク | ファイル | ステータス | 開始日時 | 完了日時 | 担当者 | 備考 |
|--------|----------|------------|----------|----------|--------|------|
| バックエンドAPI実装 | 01-backend-api.md | ✅ **完了** | 2025-07-25 | 2025-07-25 | 実装Claude君 | 主要API 3件実装完了 |
| フロントエンド実装 | 02-frontend-implementation.md | ✅ **完了** | 2025-07-25 | 2025-07-25 | 実装Claude君 | コンポーネント2件、ページ修正1件 |
```

### レビュー観点・チェックポイント

#### 🎯 **実装仕様準拠**
- タスクドキュメントの要件を満たしているか
- URL設計・API設計が仕様通りか
- 完了基準を全て満たしているか

#### 🛠️ **技術品質**
- TypeScript型安全性の確保
- エラーハンドリングの適切さ
- 既存コードとの整合性
- テストの実装・実行

#### 📱 **UI/UX品質**
- モバイル対応・レスポンシブ
- アクセシビリティ配慮
- 既存デザインとの一貫性
- ユーザー体験の向上

### レビュー結果の伝達

#### 📄 **レビューファイル経由**
1. `implementation-review.md` にレビュー結果を記載
2. 実装者に「このファイルを確認してください」と伝達
3. 修正完了後、レビューファイルに完了記録

#### 🔄 **修正・再レビューサイクル**
```
実装 → レビュー → 修正依頼 → 修正 → 確認 → 完了
```

### メンテナンス
- 月1回程度、完了済み機能の整理・アーカイブを検討
- 開発フロー自体の改善提案も `progress.md` に記録
- レビュープロセスの改善点も継続的に見直し

---

このワークフローに従って機能開発を進めることで、**一貫性のある開発プロセス**と**適切なドキュメント管理**、**高品質な実装の保証**を実現します。